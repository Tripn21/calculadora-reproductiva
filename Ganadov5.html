<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Reproductiva - Control de Ganado</title>
    <style>
        /* Los mismos estilos anteriores */
        :root {
            --primary-color: #2c7744;
            --secondary-color: #8bc34a;
            --accent-color: #ff9800;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        h1 {
            font-size: 1.8rem;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav a:hover, nav a.active {
            background-color: rgba(255,255,255,0.2);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .sidebar {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .sidebar h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar li {
            margin-bottom: 10px;
        }
        
        .sidebar a {
            display: block;
            padding: 8px 12px;
            color: var(--dark-color);
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .sidebar a:hover, .sidebar a.active {
            background-color: var(--light-color);
            color: var(--primary-color);
        }
        
        .content {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-title {
            margin-bottom: 20px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #236338;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: #7cb342;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-color);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .card-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .card-content p {
            margin-bottom: 5px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-active {
            background-color: #e8f5e9;
            color: var(--success-color);
        }
        
        .status-pending {
            background-color: #fff3e0;
            color: var(--accent-color);
        }
        
        .status-completed {
            background-color: #e3f2fd;
            color: #2196f3;
        }
        
        .status-service {
            background-color: #e1f5fe;
            color: #0288d1;
        }
        
        .notification {
            background-color: #fff8e1;
            border-left: 4px solid var(--accent-color);
            padding: 10px 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .notification h4 {
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--light-color);
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .actions {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .hidden {
            display: none;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px 0;
            color: #777;
            border-top: 1px solid #eee;
        }
        
        .alert {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .evento-proximo {
            background-color: #e8f5e9;
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 3px solid var(--success-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-cow"></i>
                <h1>Calculadora Reproductiva</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active">Inicio</a></li>
                    <li><a href="#" id="nav-fincas">Fincas</a></li>
                    <li><a href="#" id="nav-vacas">Vacas</a></li>
                    <li><a href="#" id="nav-controles">Controles</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <aside class="sidebar">
                <h3>Navegaci√≥n</h3>
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#" data-tab="registro-finca"><i class="fas fa-plus-circle"></i> Registrar Finca</a></li>
                    <li><a href="#" data-tab="registro-vaca"><i class="fas fa-plus-circle"></i> Registrar Vaca</a></li>
                    <li><a href="#" data-tab="registro-celo"><i class="fas fa-sync-alt"></i> Registrar Celo</a></li>
                    <li><a href="#" data-tab="registro-parto"><i class="fas fa-baby"></i> Registrar Parto</a></li>
                    <li><a href="#" data-tab="lista-vacas"><i class="fas fa-list"></i> Lista de Vacas</a></li>
                </ul>
                
                <h3>Fincas Activas</h3>
                <ul id="lista-fincas-sidebar">
                    <!-- Se llena din√°micamente -->
                </ul>
            </aside>

            <main class="content">
                <div class="tabs">
                    <div class="tab active" data-tab="dashboard">Dashboard</div>
                    <div class="tab" data-tab="registro-finca">Registrar Finca</div>
                    <div class="tab" data-tab="registro-vaca">Registrar Vaca</div>
                    <div class="tab" data-tab="registro-celo">Registrar Celo</div>
                    <div class="tab" data-tab="registro-parto">Registrar Parto</div>
                    <div class="tab" data-tab="lista-vacas">Lista de Vacas</div>
                </div>

                <!-- Dashboard -->
                <div id="dashboard" class="tab-content active">
                    <h2 class="section-title">Resumen Reproductivo</h2>
                    <div id="notificaciones-container">
                        <!-- Se llena din√°micamente -->
                    </div>
                    
                    <h3 class="section-title">Vacas en Seguimiento</h3>
                    <div id="vacas-dashboard">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>

                <!-- Registrar Finca -->
                <div id="registro-finca" class="tab-content">
                    <h2 class="section-title">Registrar Nueva Finca</h2>
                    <form id="form-registro-finca">
                        <div class="form-group">
                            <label for="nombre-finca">Nombre de la Finca</label>
                            <input type="text" id="nombre-finca" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="ubicacion-finca">Ubicaci√≥n</label>
                            <input type="text" id="ubicacion-finca" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="responsable-finca">Responsable</label>
                            <input type="text" id="responsable-finca" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="telefono-finca">Tel√©fono de Contacto</label>
                            <input type="tel" id="telefono-finca">
                        </div>
                        
                        <div class="form-group">
                            <label for="observaciones-finca">Observaciones</label>
                            <textarea id="observaciones-finca" rows="3"></textarea>
                        </div>
                        
                        <button type="submit">Registrar Finca</button>
                    </form>
                </div>

                <!-- Registrar Vaca -->
                <div id="registro-vaca" class="tab-content">
                    <h2 class="section-title">Registrar Nueva Vaca</h2>
                    <form id="form-registro-vaca">
                        <div class="form-group">
                            <label for="nombre-vaca">Nombre de la Vaca</label>
                            <input type="text" id="nombre-vaca" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="numero-chapa">N√∫mero de Chapa</label>
                            <input type="text" id="numero-chapa" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="finca-vaca">Finca</label>
                            <select id="finca-vaca" required>
                                <option value="">Seleccionar finca</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="raza-vaca">Raza</label>
                            <select id="raza-vaca" required>
                                <option value="">Seleccionar raza</option>
                                <option value="holstein">Holstein</option>
                                <option value="jersey">Jersey</option>
                                <option value="brahman">Brahman</option>
                                <option value="gyr">Gyr</option>
                                <option value="simental">Simental</option>
                                <option value="otra">Otra</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fecha-nacimiento-vaca">Fecha de Nacimiento (aproximada)</label>
                            <input type="date" id="fecha-nacimiento-vaca">
                        </div>
                        
                        <div class="form-group">
                            <label for="observaciones-vaca">Observaciones</label>
                            <textarea id="observaciones-vaca" rows="3"></textarea>
                        </div>
                        
                        <button type="submit">Registrar Vaca</button>
                    </form>
                </div>

                <!-- Registrar Celo -->
                <div id="registro-celo" class="tab-content">
                    <h2 class="section-title">Registrar Celo y Monta</h2>
                    <form id="form-registro-celo">
                        <div class="form-group">
                            <label for="vaca-celo">Seleccionar Vaca</label>
                            <select id="vaca-celo" required>
                                <option value="">Seleccionar vaca</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fecha-monta">Fecha de Monta</label>
                            <input type="date" id="fecha-monta" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipo-toro">Tipo de Toro</label>
                            <select id="tipo-toro" required>
                                <option value="">Seleccionar tipo</option>
                                <option value="natural">Monta Natural</option>
                                <option value="inseminacion">Inseminaci√≥n Artificial</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="toro">Toro / Semental</label>
                            <input type="text" id="toro" placeholder="Nombre o identificaci√≥n del toro">
                        </div>
                        
                        <div class="form-group">
                            <label for="es-primera-monta">
                                <input type="checkbox" id="es-primera-monta"> ¬øEs la primera monta?
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="observaciones-celo">Observaciones</label>
                            <textarea id="observaciones-celo" rows="3"></textarea>
                        </div>
                        
                        <button type="submit">Registrar Monta</button>
                    </form>
                </div>

                <!-- Registrar Parto -->
                <div id="registro-parto" class="tab-content">
                    <h2 class="section-title">Registrar Parto</h2>
                    <form id="form-registro-parto">
                        <div class="form-group">
                            <label for="vaca-parto">Seleccionar Vaca</label>
                            <select id="vaca-parto" required>
                                <option value="">Seleccionar vaca</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fecha-parto">Fecha de Parto</label>
                            <input type="date" id="fecha-parto" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipo-parto">Tipo de Parto</label>
                            <select id="tipo-parto" required>
                                <option value="">Seleccionar tipo</option>
                                <option value="normal">Normal</option>
                                <option value="dificil">Parto Dificil</option>
                                <option value="cesarea">Ces√°rea</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="cantidad-crias">Cantidad de Cr√≠as</label>
                            <input type="number" id="cantidad-crias" min="1" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="estado-crias">Estado de las Cr√≠as</label>
                            <select id="estado-crias">
                                <option value="vivas">Todas Vivas</option>
                                <option value="algunas-muertas">Algunas Muertas</option>
                                <option value="todas-muertas">Todas Muertas</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="observaciones-parto">Observaciones</label>
                            <textarea id="observaciones-parto" rows="3"></textarea>
                        </div>
                        
                        <button type="submit">Registrar Parto</button>
                    </form>
                </div>

                <!-- Lista de Vacas -->
                <div id="lista-vacas" class="tab-content">
                    <h2 class="section-title">Lista de Vacas Registradas</h2>
                    <div class="table-container">
                        <table id="tabla-vacas">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Chapa</th>
                                    <th>Finca</th>
                                    <th>Raza</th>
                                    <th>Usuario</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Se llena din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Calculadora Reproductiva para Ganado &copy; 2023 - Sistema de Control y Seguimiento</p>
        </div>
    </footer>

    <script>
        // Sistema de Almacenamiento
        class SistemaReproductivo {
            constructor() {
                this.fincas = this.cargarDatos('fincas') || [];
                this.vacas = this.cargarDatos('vacas') || [];
                this.controles = this.cargarDatos('controles') || [];
                this.partos = this.cargarDatos('partos') || [];
                this.inicializar();
            }

            // Cargar datos del localStorage
            cargarDatos(clave) {
                const datos = localStorage.getItem(`reproductivo_${clave}`);
                return datos ? JSON.parse(datos) : null;
            }

            // Guardar datos en localStorage
            guardarDatos(clave, datos) {
                localStorage.setItem(`reproductivo_${clave}`, JSON.stringify(datos));
            }

            // Generar ID √∫nico
            generarId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            // Inicializar la aplicaci√≥n
            inicializar() {
                this.cargarFincasEnSelectores();
                this.cargarVacasEnSelectores();
                this.actualizarDashboard();
                this.actualizarListaVacas();
                this.actualizarSidebar();
            }

            // Registrar nueva finca
            registrarFinca(datos) {
                const nuevaFinca = {
                    id: this.generarId(),
                    ...datos,
                    fechaRegistro: new Date().toISOString()
                };
                
                this.fincas.push(nuevaFinca);
                this.guardarDatos('fincas', this.fincas);
                this.cargarFincasEnSelectores();
                this.actualizarSidebar();
                return nuevaFinca;
            }

            // Registrar nueva vaca
            registrarVaca(datos) {
                const usuario = datos.nombre.substring(0, 4).toUpperCase() + datos.numeroChapa;
                const nuevaVaca = {
                    id: this.generarId(),
                    usuario: usuario,
                    ...datos,
                    fechaRegistro: new Date().toISOString(),
                    estado: 'activa'
                };
                
                this.vacas.push(nuevaVaca);
                this.guardarDatos('vacas', this.vacas);
                this.cargarVacasEnSelectores();
                this.actualizarDashboard();
                this.actualizarListaVacas();
                return nuevaVaca;
            }

            // Registrar control de celo
            registrarControl(datos) {
                // Calcular fechas importantes
                const fechaProximoCelo = this.calcularProximaFecha(datos.fechaMonta, 15);
                const fechaProbableParto = this.calcularProximaFecha(datos.fechaMonta, 280);
                
                const nuevoControl = {
                    id: this.generarId(),
                    ...datos,
                    fechaRegistro: new Date().toISOString(),
                    fechaProximoCelo: fechaProximoCelo,
                    fechaProbableParto: fechaProbableParto,
                    esPrimeraMonta: datos.esPrimeraMonta || false
                };
                
                this.controles.push(nuevoControl);
                this.guardarDatos('controles', this.controles);
                
                // Actualizar estado de la vaca
                this.actualizarEstadoVaca(datos.vacaId, 'en_servicio');
                
                this.actualizarDashboard();
                return nuevoControl;
            }

            // Registrar parto
            registrarParto(datos) {
                const nuevoParto = {
                    id: this.generarId(),
                    ...datos,
                    fechaRegistro: new Date().toISOString(),
                    fechaProximoCiclo: this.calcularProximaFecha(datos.fechaParto, 60)
                };
                
                this.partos.push(nuevoParto);
                this.guardarDatos('partos', this.partos);
                
                // Actualizar estado de la vaca
                this.actualizarEstadoVaca(datos.vacaId, 'en_lactancia');
                
                this.actualizarDashboard();
                return nuevoParto;
            }

            // Calcular fecha sumando d√≠as
            calcularProximaFecha(fechaBase, dias) {
                const fecha = new Date(fechaBase);
                fecha.setDate(fecha.getDate() + dias);
                return fecha.toISOString().split('T')[0];
            }

            // Formatear fecha para mostrar
            formatearFecha(fecha) {
                return new Date(fecha).toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            // Actualizar estado de una vaca
            actualizarEstadoVaca(vacaId, nuevoEstado) {
                const vaca = this.vacas.find(v => v.id === vacaId);
                if (vaca) {
                    vaca.estado = nuevoEstado;
                    this.guardarDatos('vacas', this.vacas);
                }
            }

            // Cargar fincas en selectores
            cargarFincasEnSelectores() {
                const selectores = ['finca-vaca'];
                selectores.forEach(selectorId => {
                    const selector = document.getElementById(selectorId);
                    if (selector) {
                        selector.innerHTML = '<option value="">Seleccionar finca</option>';
                        this.fincas.forEach(finca => {
                            const option = document.createElement('option');
                            option.value = finca.id;
                            option.textContent = finca.nombre;
                            selector.appendChild(option);
                        });
                    }
                });
            }

            // Cargar vacas en selectores
            cargarVacasEnSelectores() {
                const selectores = ['vaca-celo', 'vaca-parto'];
                selectores.forEach(selectorId => {
                    const selector = document.getElementById(selectorId);
                    if (selector) {
                        selector.innerHTML = '<option value="">Seleccionar vaca</option>';
                        this.vacas.forEach(vaca => {
                            const option = document.createElement('option');
                            option.value = vaca.id;
                            option.textContent = `${vaca.nombre} (#${vaca.numeroChapa}) - ${this.obtenerNombreFinca(vaca.fincaId)}`;
                            selector.appendChild(option);
                        });
                    }
                });
            }

            // Obtener nombre de finca por ID
            obtenerNombreFinca(fincaId) {
                const finca = this.fincas.find(f => f.id === fincaId);
                return finca ? finca.nombre : 'Finca no encontrada';
            }

            // Actualizar dashboard
            actualizarDashboard() {
                this.actualizarNotificaciones();
                this.actualizarVacasDashboard();
            }

            // Actualizar notificaciones
            actualizarNotificaciones() {
                const container = document.getElementById('notificaciones-container');
                if (!container) return;

                const hoy = new Date();
                let notificaciones = [];

                // Verificar controles para pr√≥ximos celos
                this.controles.forEach(control => {
                    const fechaCelo = new Date(control.fechaProximoCelo);
                    const diffTime = fechaCelo - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays <= 7 && diffDays >= 0) {
                        const vaca = this.vacas.find(v => v.id === control.vacaId);
                        notificaciones.push({
                            tipo: 'celo',
                            mensaje: `Vaca "${vaca.nombre}" pr√≥xima a repetir celo en ${diffDays} d√≠as (${this.formatearFecha(control.fechaProximoCelo)})`,
                            fecha: control.fechaProximoCelo,
                            importancia: diffDays <= 3 ? 'alta' : 'media'
                        });
                    }
                });

                // Verificar controles para pr√≥ximos partos
                this.controles.forEach(control => {
                    const fechaParto = new Date(control.fechaProbableParto);
                    const diffTime = fechaParto - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays <= 21 && diffDays >= 0) {
                        const vaca = this.vacas.find(v => v.id === control.vacaId);
                        notificaciones.push({
                            tipo: 'parto',
                            mensaje: `Vaca "${vaca.nombre}" pr√≥xima al parto en ${diffDays} d√≠as (${this.formatearFecha(control.fechaProbableParto)})`,
                            fecha: control.fechaProbableParto,
                            importancia: diffDays <= 7 ? 'alta' : 'media'
                        });
                    }
                });

                // Verificar partos para nuevos ciclos
                this.partos.forEach(parto => {
                    const fechaCiclo = new Date(parto.fechaProximoCiclo);
                    const diffTime = fechaCiclo - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays <= 14 && diffDays >= 0) {
                        const vaca = this.vacas.find(v => v.id === parto.vacaId);
                        notificaciones.push({
                            tipo: 'ciclo',
                            mensaje: `Vaca "${vaca.nombre}" debe iniciar nuevo ciclo reproductivo en ${diffDays} d√≠as (${this.formatearFecha(parto.fechaProximoCiclo)})`,
                            fecha: parto.fechaProximoCiclo,
                            importancia: diffDays <= 5 ? 'alta' : 'media'
                        });
                    }
                });

                // Ordenar notificaciones por fecha e importancia
                notificaciones.sort((a, b) => {
                    if (a.importancia === b.importancia) {
                        return new Date(a.fecha) - new Date(b.fecha);
                    }
                    return a.importancia === 'alta' ? -1 : 1;
                });

                // Mostrar notificaciones
                if (notificaciones.length > 0) {
                    container.innerHTML = `
                        <div class="notification">
                            <h4><i class="fas fa-bell"></i> Pr√≥ximos Eventos</h4>
                            ${notificaciones.map(notif => `
                                <div class="evento-proximo">
                                    <strong>${notif.tipo.toUpperCase()}:</strong> ${notif.mensaje}
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    container.innerHTML = '<p>No hay notificaciones en este momento.</p>';
                }
            }

            // Actualizar vacas en el dashboard
            actualizarVacasDashboard() {
                const container = document.getElementById('vacas-dashboard');
                if (!container) return;

                const vacasActivas = this.vacas.filter(vaca => vaca.estado !== 'inactiva');
                
                if (vacasActivas.length === 0) {
                    container.innerHTML = '<p>No hay vacas registradas.</p>';
                    return;
                }

                container.innerHTML = vacasActivas.map(vaca => {
                    const ultimoControl = this.obtenerUltimoControl(vaca.id);
                    const ultimoParto = this.obtenerUltimoParto(vaca.id);
                    const estado = this.determinarEstadoVaca(vaca, ultimoControl, ultimoParto);
                    
                    return `
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">${vaca.nombre}</div>
                                <span class="status-badge ${estado.clase}">${estado.texto}</span>
                            </div>
                            <div class="card-content">
                                <p><strong>Finca:</strong> ${this.obtenerNombreFinca(vaca.fincaId)}</p>
                                <p><strong>Raza:</strong> ${vaca.raza}</p>
                                <p><strong>Chapa:</strong> #${vaca.numeroChapa}</p>
                                <p><strong>Usuario:</strong> ${vaca.usuario}</p>
                                ${ultimoControl ? `
                                    <p><strong>√öltima monta:</strong> ${this.formatearFecha(ultimoControl.fechaMonta)}</p>
                                    ${ultimoControl.esPrimeraMonta ? '<p><em>‚úì Primera monta registrada</em></p>' : ''}
                                ` : ''}
                                ${estado.proximoEvento ? `
                                    <div class="evento-proximo">
                                        <strong>Pr√≥ximo evento:</strong> ${estado.proximoEvento}
                                    </div>
                                ` : ''}
                                <div class="actions">
                                    ${vaca.estado === 'activa' ? '<button class="action-btn btn-secondary" onclick="sistema.irARegistroCelo(\'' + vaca.id + '\')">Registrar Celo</button>' : ''}
                                    ${vaca.estado === 'en_servicio' ? '<button class="action-btn btn-secondary" onclick="sistema.irARegistroParto(\'' + vaca.id + '\')">Registrar Parto</button>' : ''}
                                    ${vaca.estado === 'en_lactancia' && this.estaListaParaNuevoCiclo(vaca.id) ? '<button class="action-btn btn-secondary" onclick="sistema.irARegistroCelo(\'' + vaca.id + '\')">Iniciar Nuevo Ciclo</button>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Determinar estado de la vaca
            determinarEstadoVaca(vaca, control, parto) {
                const hoy = new Date();
                
                if (vaca.estado === 'en_servicio' && control) {
                    const fechaParto = new Date(control.fechaProbableParto);
                    const fechaProxCelo = new Date(control.fechaProximoCelo);
                    
                    if (fechaParto <= hoy) {
                        return { 
                            texto: 'Pr√≥xima al parto', 
                            clase: 'status-pending', 
                            proximoEvento: `Parto: ${this.formatearFecha(control.fechaProbableParto)} (Vencido)` 
                        };
                    }
                    
                    const diffParto = Math.ceil((fechaParto - hoy) / (1000 * 60 * 60 * 24));
                    const diffCelo = Math.ceil((fechaProxCelo - hoy) / (1000 * 60 * 60 * 24));
                    
                    if (diffCelo <= 7 && diffCelo >= 0) {
                        return { 
                            texto: 'En servicio', 
                            clase: 'status-service', 
                            proximoEvento: `Pr√≥ximo celo: ${this.formatearFecha(control.fechaProximoCelo)} (en ${diffCelo} d√≠as)` 
                        };
                    }
                    
                    return { 
                        texto: 'En servicio', 
                        clase: 'status-service', 
                        proximoEvento: `Parto probable: ${this.formatearFecha(control.fechaProbableParto)} (en ${diffParto} d√≠as)` 
                    };
                }
                
                if (vaca.estado === 'en_lactancia' && parto) {
                    const fechaCiclo = new Date(parto.fechaProximoCiclo);
                    if (fechaCiclo <= hoy) {
                        return { 
                            texto: 'Lista para celo', 
                            clase: 'status-pending', 
                            proximoEvento: 'Iniciar nuevo ciclo (Vencido)' 
                        };
                    }
                    const diffCiclo = Math.ceil((fechaCiclo - hoy) / (1000 * 60 * 60 * 24));
                    return { 
                        texto: 'En lactancia', 
                        clase: 'status-active', 
                        proximoEvento: `Nuevo ciclo: ${this.formatearFecha(parto.fechaProximoCiclo)} (en ${diffCiclo} d√≠as)` 
                    };
                }
                
                return { 
                    texto: 'Activa', 
                    clase: 'status-active', 
                    proximoEvento: 'Esperando registro de celo' 
                };
            }

            // Verificar si una vaca est√° lista para nuevo ciclo
            estaListaParaNuevoCiclo(vacaId) {
                const parto = this.obtenerUltimoParto(vacaId);
                if (!parto) return false;
                
                const hoy = new Date();
                const fechaCiclo = new Date(parto.fechaProximoCiclo);
                return fechaCiclo <= hoy;
            }

            // Obtener √∫ltimo control de una vaca
            obtenerUltimoControl(vacaId) {
                const controlesVaca = this.controles.filter(c => c.vacaId === vacaId);
                return controlesVaca.length > 0 ? 
                    controlesVaca.reduce((a, b) => new Date(a.fechaMonta) > new Date(b.fechaMonta) ? a : b) 
                    : null;
            }

            // Obtener √∫ltimo parto de una vaca
            obtenerUltimoParto(vacaId) {
                const partosVaca = this.partos.filter(p => p.vacaId === vacaId);
                return partosVaca.length > 0 ? 
                    partosVaca.reduce((a, b) => new Date(a.fechaParto) > new Date(b.fechaParto) ? a : b) 
                    : null;
            }

            // Actualizar lista de vacas
            actualizarListaVacas() {
                const tbody = document.querySelector('#tabla-vacas tbody');
                if (!tbody) return;

                tbody.innerHTML = this.vacas.map(vaca => {
                    const estado = this.determinarEstadoVaca(vaca, 
                        this.obtenerUltimoControl(vaca.id), 
                        this.obtenerUltimoParto(vaca.id));
                    
                    return `
                        <tr>
                            <td>${vaca.nombre}</td>
                            <td>#${vaca.numeroChapa}</td>
                            <td>${this.obtenerNombreFinca(vaca.fincaId)}</td>
                            <td>${vaca.raza}</td>
                            <td>${vaca.usuario}</td>
                            <td><span class="status-badge ${estado.clase}">${estado.texto}</span></td>
                            <td class="actions">
                                <button class="action-btn" onclick="sistema.verDetallesVaca('${vaca.id}')">Ver</button>
                                ${vaca.estado === 'activa' ? `<button class="action-btn btn-secondary" onclick="sistema.irARegistroCelo('${vaca.id}')">Celo</button>` : ''}
                                ${vaca.estado === 'en_servicio' ? `<button class="action-btn btn-secondary" onclick="sistema.irARegistroParto('${vaca.id}')">Parto</button>` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // Actualizar sidebar
            actualizarSidebar() {
                const lista = document.getElementById('lista-fincas-sidebar');
                if (!lista) return;

                lista.innerHTML = this.fincas.map(finca => 
                    `<li><a href="#" onclick="sistema.filtrarPorFinca('${finca.id}')">${finca.nombre}</a></li>`
                ).join('');
            }

            // Navegaci√≥n a registro de celo con vaca seleccionada
            irARegistroCelo(vacaId) {
                this.cambiarPesta√±a('registro-celo');
                setTimeout(() => {
                    document.getElementById('vaca-celo').value = vacaId;
                }, 100);
            }

            // Navegaci√≥n a registro de parto con vaca seleccionada
            irARegistroParto(vacaId) {
                this.cambiarPesta√±a('registro-parto');
                setTimeout(() => {
                    document.getElementById('vaca-parto').value = vacaId;
                }, 100);
            }

            // Cambiar pesta√±a
            cambiarPesta√±a(tabId) {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
                document.getElementById(tabId).classList.add('active');
            }

            // Mostrar alerta
            mostrarAlerta(mensaje, tipo = 'success') {
                const alerta = document.createElement('div');
                alerta.className = `alert alert-${tipo}`;
                alerta.textContent = mensaje;
                
                const content = document.querySelector('.content');
                content.insertBefore(alerta, content.firstChild);
                
                setTimeout(() => {
                    alerta.remove();
                }, 5000);
            }

            // Ver detalles de vaca (placeholder)
            verDetallesVaca(vacaId) {
                const vaca = this.vacas.find(v => v.id === vacaId);
                const control = this.obtenerUltimoControl(vacaId);
                const parto = this.obtenerUltimoParto(vacaId);
                
                let mensaje = `Detalles de ${vaca.nombre}:\n`;
                mensaje += `Chapa: #${vaca.numeroChapa}\n`;
                mensaje += `Finca: ${this.obtenerNombreFinca(vaca.fincaId)}\n`;
                mensaje += `Raza: ${vaca.raza}\n`;
                mensaje += `Usuario: ${vaca.usuario}\n`;
                
                if (control) {
                    mensaje += `\n√öltima monta: ${this.formatearFecha(control.fechaMonta)}\n`;
                    mensaje += `Pr√≥ximo celo: ${this.formatearFecha(control.fechaProximoCelo)}\n`;
                    mensaje += `Parto probable: ${this.formatearFecha(control.fechaProbableParto)}\n`;
                    if (control.esPrimeraMonta) {
                        mensaje += `(Primera monta registrada)\n`;
                    }
                }
                
                if (parto) {
                    mensaje += `\n√öltimo parto: ${this.formatearFecha(parto.fechaParto)}\n`;
                    mensaje += `Pr√≥ximo ciclo: ${this.formatearFecha(parto.fechaProximoCiclo)}\n`;
                }
                
                alert(mensaje);
            }
        }

        // Inicializar el sistema
        const sistema = new SistemaReproductivo();

        // Configurar event listeners cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            // Navegaci√≥n por pesta√±as
            document.querySelectorAll('.tab, .sidebar a[data-tab]').forEach(element => {
                element.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    sistema.cambiarPesta√±a(tabId);
                    
                    // Actualizar clase active en sidebar
                    document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Registrar finca
            document.getElementById('form-registro-finca').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const datos = {
                    nombre: document.getElementById('nombre-finca').value,
                    ubicacion: document.getElementById('ubicacion-finca').value,
                    responsable: document.getElementById('responsable-finca').value,
                    telefono: document.getElementById('telefono-finca').value,
                    observaciones: document.getElementById('observaciones-finca').value
                };
                
                sistema.registrarFinca(datos);
                sistema.mostrarAlerta('Finca registrada exitosamente');
                this.reset();
            });

            // Registrar vaca
            document.getElementById('form-registro-vaca').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const datos = {
                    nombre: document.getElementById('nombre-vaca').value,
                    numeroChapa: document.getElementById('numero-chapa').value,
                    fincaId: document.getElementById('finca-vaca').value,
                    raza: document.getElementById('raza-vaca').value,
                    fechaNacimiento: document.getElementById('fecha-nacimiento-vaca').value,
                    observaciones: document.getElementById('observaciones-vaca').value
                };
                
                sistema.registrarVaca(datos);
                sistema.mostrarAlerta('Vaca registrada exitosamente');
                this.reset();
            });

            // Registrar control de celo
            document.getElementById('form-registro-celo').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const datos = {
                    vacaId: document.getElementById('vaca-celo').value,
                    fechaMonta: document.getElementById('fecha-monta').value,
                    tipoToro: document.getElementById('tipo-toro').value,
                    toro: document.getElementById('toro').value,
                    esPrimeraMonta: document.getElementById('es-primera-monta').checked,
                    observaciones: document.getElementById('observaciones-celo').value
                };
                
                sistema.registrarControl(datos);
                
                let mensaje = 'Control de celo registrado exitosamente.';
                if (datos.esPrimeraMonta) {
                    mensaje += ' Se registr√≥ como primera monta.';
                }
                mensaje += ' Se programaron notificaciones.';
                
                sistema.mostrarAlerta(mensaje);
                this.reset();
                document.getElementById('es-primera-monta').checked = false;
            });

            // Registrar parto
            document.getElementById('form-registro-parto').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const datos = {
                    vacaId: document.getElementById('vaca-parto').value,
                    fechaParto: document.getElementById('fecha-parto').value,
                    tipoParto: document.getElementById('tipo-parto').value,
                    cantidadCrias: document.getElementById('cantidad-crias').value,
                    estadoCrias: document.getElementById('estado-crias').value,
                    observaciones: document.getElementById('observaciones-parto').value
                };
                
                sistema.registrarParto(datos);
                sistema.mostrarAlerta('Parto registrado exitosamente. Se program√≥ notificaci√≥n para nuevo ciclo.');
                this.reset();
            });

            // Generar usuario autom√°ticamente
            document.getElementById('nombre-vaca').addEventListener('input', generarUsuario);
            document.getElementById('numero-chapa').addEventListener('input', generarUsuario);
            
            function generarUsuario() {
                const nombre = document.getElementById('nombre-vaca').value.trim().toUpperCase();
                const chapa = document.getElementById('numero-chapa').value;
                
                if (nombre && chapa) {
                    const usuario = nombre.substring(0, 4) + chapa;
                    // Podr√≠as mostrar el usuario generado en un campo si lo deseas
                    console.log("Usuario generado:", usuario);
                }
            }
        });
    </script>
</body>
</html>